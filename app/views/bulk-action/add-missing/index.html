{% extends "_templates/_page.html" %}

{% set pageHeading = "Update incomplete trainee records" %}
{% set navActive = 'bulk' %}

{% set registeredTrainees = data.filteredRecords | filterByStatus("Draft", true) %}

{% set incompleteTraineesThatCanBeUpdated = registeredTrainees | filterByIncomplete | filterOutEarlyYears | filterByStatus(["Deferred", "Withdrawn"], true) %}
{% set incompleteTraineesThatCannotBeUpdated = (registeredTrainees | filterByIncomplete | length) - (incompleteTraineesThatCanBeUpdated | length ) %}

{% set traineesWithoutStartDates =  incompleteTraineesThatCanBeUpdated | filterByNeedsStartDate | length %}
{% set traineesWithoutPlacements =  incompleteTraineesThatCanBeUpdated | filterByNeedsPlacements | length %}

{% set minPlacementsRequired = data.settings.minPlacementsRequired %}

{% set filename = "incomplete-trainee-records" %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds-from-desktop">
      <h1 class="govuk-heading-l">
        <span class="govuk-caption-l">{{ data.signedInProviders | andSeparate }}</span>
        {{ pageHeading }}
      </h1>

      <p class="govuk-body">
        You have incomplete trainee records:
      </p>
      <ul class="govuk-list govuk-list--bullet">
        <li>{{ incompleteTraineesThatCanBeUpdated | length }} that can be updated using spreadsheet software</li>
        <li><a href="/records?%5BfilterCompleteStatus%5D=Incomplete&%5BfilterPhase%5D=Early+years">{{ incompleteTraineesThatCannotBeUpdated }} that need to be updated individually</a></li>
      </ul>

      <h2 class="govuk-heading-m">
        How to update records
      </h2>


      <ol class="govuk-list govuk-list--number">
        <li>Export the incomplete trainee records file</li>
        <li>
          Open the file <span class="app-nowrap">‘{{ filename }}.csv’</span> in your <span class="app-nowrap">spreadsheet software</span>
        </li>
        <li>Add the missing information</li>
        <li>Save your file as a ‘csv’</li>
        <li>Upload the file</li>
      </ol>

      <h2 class="govuk-heading-m">
        How to add information
      </h2>

      {% if traineesWithoutStartDates %}
        <h3 class="govuk-heading-s">
          Start dates
        </h3>
        <p class="govuk-body">
          For each trainee missing a start date, in the column ‘Start date’ add the date the trainee began their ITT.
        </p>
        <p class="govuk-body">
          The date must be written in the format <span class="app-nowrap">‘DD-MM-YYYY’</span>. For example, if the trainee started on 20 September {{ data.years.defaultCourseYear }}, write <span class="app-nowrap">‘20-09-{{ data.years.defaultCourseYear }}’</span>.
        </p>
        <p class="govuk-body">
          If a trainee does not have a start date, leave the cell empty.
        </p>
      {% endif %}

      {% if traineesWithoutStartDates %}
        <h3 class="govuk-heading-s">
          Placement details
        </h3>
        <p class="govuk-body">
          For each trainee missing placement details, in the columns ‘Placement 1’, ‘Placement 2’ and where applicable ‘Placement 3’ add the school’s URN.
        </p>
        <p class="govuk-body">
          You can find the URNs using <a href="https://www.get-information-schools.service.gov.uk/Search">Get information about schools</a>.
        </p>
        {# TO DO — ‘I don't think individial records is that clear?’ #}
        <p class="govuk-body">
          If the setting does not have a URN, add it’s name to the individual record.
        </p>
        <p class="govuk-body">
          If a trainee did more than {{ minPlacementsRequired + 1 }} placements, add those placements to the individual record.
        </p>
        <p class="govuk-body">
          If you do not have the information for a placement, leave the cell empty.
        </p>
      {% endif %}

      <h2 class="govuk-heading-m">
        Export trainee records
      </h2>
      <p class="govuk-body govuk-!-margin-bottom-4">
        <a href="/public/downloads/incomplete-trainee-records.csv" download="{{ filename }}.csv">Export incomplete trainee records (csv)</a>
      </p>

      <form action="/bulk-action/add-missing/file-uploaded" method="post" novalidate>
        <h2 class="govuk-heading-m">
          Upload updated records
        </h2>

        {{ govukFileUpload({
          id: "file-upload-1",
          name: "file-upload-1",
          label: {
            text: "Upload a file"
          }
        }) }}
        {{ govukButton({
          text: "Upload records"
        }) }}
      </form>

    </div>
  </div>

{% endblock %}
